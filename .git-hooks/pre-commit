#!/bin/bash

# Pre-commit hook for linkedin-formatter package
# Ensures package builds and tests pass before committing

set -e

echo "ğŸ”’ Pre-commit: Checking linkedin-formatter package..."

# Change to the package directory
cd "$(git rev-parse --show-toplevel)/families/supernal-social/packages/@supernal-social/linkedin-formatter"

# Check if package.json exists
if [ ! -f "package.json" ]; then
    echo "âš ï¸  Skipping: Not in linkedin-formatter package directory"
    exit 0
fi

# Run TypeScript check
echo "ğŸ“ Running TypeScript check..."
if ! pnpm exec tsc --noEmit; then
    echo "âŒ TypeScript errors found. Please fix before committing."
    exit 1
fi

echo "âœ… TypeScript check passed!"

# Run build
echo "ğŸ”¨ Building package..."
if ! pnpm build; then
    echo "âŒ Build failed. Please fix before committing."
    exit 1
fi

# Run tests
echo "ğŸ§ª Running tests..."
if ! node test.js; then
    echo "âŒ Tests failed. Please fix before committing."
    exit 1
fi

echo "âœ… All checks passed!"

exit 0

